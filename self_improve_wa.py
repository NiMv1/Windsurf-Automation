"""
Self-Improve WA - WA —É–ª—É—á—à–∞–µ—Ç —Å–∞–º–∞ —Å–µ–±—è!
–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á–∏ –≤ —Ç–µ–∫—É—â–µ–µ –æ–∫–Ω–æ Cascade –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è WA
"""

import sys
import os
import time

sys.path.insert(0, os.path.join(os.path.dirname(__file__), 'src'))

from windsurf_automation import find_windsurf_windows, activate_window_by_hwnd
import keyboard
import pyperclip

# –ü—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É WA
WA_PROJECT = r"C:\Users\bnex4\CascadeProjects\Windsurf-Automation"

# –ó–∞–¥–∞—á–∏ –¥–ª—è —Å–∞–º–æ—É–ª—É—á—à–µ–Ω–∏—è WA
SELF_IMPROVE_TASKS = [
    {
        "id": 1,
        "title": "–î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–¥–∞—á",
        "prompt": """–ü—Ä–æ–µ–∫—Ç: C:\\Users\\bnex4\\CascadeProjects\\Windsurf-Automation

–ó–ê–î–ê–ß–ê: –î–æ–±–∞–≤—å —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∑–∞–¥–∞—á –≤ gui.py

–¢–†–ï–ë–û–í–ê–ù–ò–Ø:
1. –î–æ–±–∞–≤—å —Ç–∞–π–º–µ—Ä –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç git diff –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫
2. –ï—Å–ª–∏ –µ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è - –ø–æ–∫–∞–∑—ã–≤–∞–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
3. –î–æ–±–∞–≤—å –∫–Ω–æ–ø–∫—É "–ü—Ä–∏–Ω—è—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è" (git add + commit)
4. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º

–û–¢–ß–Å–¢:
## –°–¥–µ–ª–∞–Ω–æ
## –ü—Ä–æ–±–ª–µ–º—ã"""
    },
    {
        "id": 2,
        "title": "–î–æ–±–∞–≤–∏—Ç—å –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á –¥–ª—è –∏–≥—Ä—ã",
        "prompt": """–ü—Ä–æ–µ–∫—Ç: C:\\Users\\bnex4\\CascadeProjects\\Windsurf-Automation

–ó–ê–î–ê–ß–ê: –î–æ–±–∞–≤—å –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏–≥—Ä—ã slime-rpg

–¢–†–ï–ë–û–í–ê–ù–ò–Ø:
1. –í tasks/tasks.json –¥–æ–±–∞–≤—å –∑–∞–¥–∞—á–∏ –¥–ª—è –∏–≥—Ä—ã:
   - –ù–æ–≤—ã–π –≤—Ä–∞–≥: –õ–µ–¥—è–Ω–æ–π –≥–æ–ª–µ–º
   - –ù–æ–≤–∞—è –ª–æ–∫–∞—Ü–∏—è: –õ–µ–¥—è–Ω–∞—è –ø–µ—â–µ—Ä–∞
   - –ù–æ–≤—ã–π –±–æ—Å—Å: –ö–æ—Ä–æ–ª—å –õ—å–¥–∞
2. –ö–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å prompt –¥–ª—è GPT
3. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º

–û–¢–ß–Å–¢:
## –°–¥–µ–ª–∞–Ω–æ
## –ü—Ä–æ–±–ª–µ–º—ã"""
    },
    {
        "id": 3,
        "title": "–£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ",
        "prompt": """–ü—Ä–æ–µ–∫—Ç: C:\\Users\\bnex4\\CascadeProjects\\Windsurf-Automation

–ó–ê–î–ê–ß–ê: –£–ª—É—á—à–∏ —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ WA

–¢–†–ï–ë–û–í–ê–ù–ò–Ø:
1. –î–æ–±–∞–≤—å —Ä–æ—Ç–∞—Ü–∏—é –ª–æ–≥–æ–≤ (–º–∞–∫—Å–∏–º—É–º 5 —Ñ–∞–π–ª–æ–≤ –ø–æ 1MB)
2. –î–æ–±–∞–≤—å —Ü–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å
3. –õ–æ–≥–∏—Ä—É–π –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º

–û–¢–ß–Å–¢:
## –°–¥–µ–ª–∞–Ω–æ
## –ü—Ä–æ–±–ª–µ–º—ã"""
    }
]


def send_task_to_current_window(task: dict) -> bool:
    """–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É –≤ —Ç–µ–∫—É—â–µ–µ –æ–∫–Ω–æ Cascade"""
    print(f"\nüì§ –û—Ç–ø—Ä–∞–≤–ª—è—é –∑–∞–¥–∞—á—É: {task['title']}")
    
    # Ctrl+L - –æ—Ç–∫—Ä—ã—Ç—å/—Ñ–æ–∫—É—Å Cascade
    keyboard.send('ctrl+l')
    time.sleep(1.5)
    
    # –í—Å—Ç–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á—É
    pyperclip.copy(task['prompt'])
    keyboard.send('ctrl+v')
    time.sleep(0.3)
    
    # Enter - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å
    keyboard.send('enter')
    time.sleep(0.5)
    
    print(f"   ‚úÖ –ó–∞–¥–∞—á–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!")
    return True


def main():
    print("=" * 50)
    print("üîÑ SELF-IMPROVE WA")
    print("WA —É–ª—É—á—à–∞–µ—Ç —Å–∞–º–∞ —Å–µ–±—è!")
    print("=" * 50)
    
    print(f"\nüìÅ –ü—Ä–æ–µ–∫—Ç: {WA_PROJECT}")
    print(f"üìã –ó–∞–¥–∞—á –¥–ª—è —Å–∞–º–æ—É–ª—É—á—à–µ–Ω–∏—è: {len(SELF_IMPROVE_TASKS)}")
    
    print("\n‚ö†Ô∏è –ß–µ—Ä–µ–∑ 3 —Å–µ–∫ –æ—Ç–ø—Ä–∞–≤–ª—é –∑–∞–¥–∞—á—É –≤ —Ç–µ–∫—É—â–µ–µ –æ–∫–Ω–æ!")
    print("   –£–±–µ–¥–∏—Å—å —á—Ç–æ Cascade sidebar –æ—Ç–∫—Ä—ã—Ç (Ctrl+L)")
    time.sleep(3)
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É
    task = SELF_IMPROVE_TASKS[0]
    send_task_to_current_window(task)
    
    print("\n" + "=" * 50)
    print("‚úÖ –ó–∞–¥–∞—á–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!")
    print("WA —Ç–µ–ø–µ—Ä—å —É–ª—É—á—à–∞–µ—Ç —Å–∞–º–∞ —Å–µ–±—è!")
    print("=" * 50)


if __name__ == "__main__":
    main()
